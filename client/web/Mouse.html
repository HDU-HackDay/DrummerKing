<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>打地鼠</title>
	<link rel="stylesheet" href="style/less/Mouse.css">
</head>
<body>
	<audio src="music/hit.mov" id="hitMusic"></audio>
	<audio src="music/miss.mp3" id="missMusic"></audio>
	<audio src="music/show.mp3" id="showMusic"></audio>

	<div class="main">
		<div class="contain">
			<div class="wrap hole1">
				<img src="image/hole.png" class="hole" alt="">
				<img src="image/mouse.png" class="mouse" alt="">
				<img src="image/hammer.png" class="hammer" alt="">
			</div>
			<div class="wrap hole2">
				<img src="image/hole.png" class="hole" alt="">
				<img src="image/mouse.png" class="mouse" alt="">
				<img src="image/hammer.png" class="hammer" alt="">
			</div>
			<div class="wrap hole3">
				<img src="image/hole.png" class="hole" alt="">
				<img src="image/mouse.png" class="mouse" alt="">
				<img src="image/hammer.png" class="hammer" alt="">
			</div>
		</div>
	</div>
	<script src="scripts/libs/jquery-2.1.1.min.js"></script>
	<script src="scripts/socket.js"></script>
	<script>
		$(function(){
			var oMouse = $(".mouse");
			var oHammer = $(".hammer");
			var mouseList = [0,0,0];
			var hitMusic = document.getElementById("hitMusic");
			var missMusic = document.getElementById("missMusic");
			var showMusic = document.getElementById("showMusic");

			setInterval(showMouse,Math.random()*3000);
			// 连接socket通信
			var Server = new websocket('ws://192.168.1.112:9300');

			Server.connect();
			Server.bind('message', function( payload ) {
			    var payload = JSON.parse(payload);
			
				oHammer.css({
					"display": "none",
					"transform": "rotate(30deg)",
					"-ms-transform": "rotate(30deg)",		/* IE 9 */
					"-webkit-transform": "rotate(30deg)",	/* Safari and Chrome */
					"-o-transform": "rotate(30deg)",	/* Opera */
					"-moz-transform": "rotate(30deg)"		/* Firefox */
				});


				if(payload.data == 0){	//Q
					oHammer.eq(0).show(100,function(){						
						oHammer.eq(0).css({"-webkit-transform": "rotate(-20deg)"});
						setTimeout(function(){
							oHammer.eq(0).css("display", "none");
						}, 500)
					});	
					oHammer.each(function(k,o){
						if(k == 0){	//如果是当前锤子的键值
							if(mouseList[0]==1){	//如果打中了
								console.log("bingo");
								hitMusic.play();
								oMouse.eq(k).animate({
									"left":"100px",
									"top":"100px",
									"width":"0"
								},"fast",function(){
									mouseList[0]=0;
								})
							}else{	//如果没打中
								missMusic.play();
							}		
						}
					})	
				}
				if(payload.data == 1){	//W
					oHammer.eq(1).show(100,function(){
						oHammer.eq(1).css({"-webkit-transform": "rotate(-20deg)"});
						setTimeout(function(){
							oHammer.eq(1).css("display", "none");
						}, 500)
					});
					oHammer.each(function(k,o){
						if(k == 1){
							if(mouseList[1]==1){
								console.log("bingo");
								hitMusic.play();
								oMouse.eq(k).animate({
									"left":"100px",
									"top":"100px",
									"width":"0"
								},"fast",function(){
									mouseList[1]=0;
								})
							}else{
								missMusic.play();
							}
						}
					})	
				}
				if(payload.data == 2){	//E
					oHammer.eq(2).show(100,function(){		
						oHammer.eq(2).css({"-webkit-transform": "rotate(-20deg)"});
						setTimeout(function(){
							oHammer.eq(2).css("display", "none");
						}, 500)
					});
					oHammer.each(function(k,o){
						if(k == 2){
							if(mouseList[2]==1){
								console.log("bingo");
								hitMusic.play();
								oMouse.eq(k).animate({
									"left":"100px",
									"top":"100px",
									"width":"0"
								},"fast",function(){
									mouseList[2]=0;
								})
							}else{
								missMusic.play();
							}
						}
					})	
				}
			});	

			function showMouse(){	//生成地鼠
				
				var _index = Math.round(Math.random()*2);

				if(mouseList[_index]==0){
					oMouse.eq(_index).css({
						"width": "200px",
						"left": "0px",
						"top": "-80px",
						"display": "block"
					});
					mouseList[_index] = 1;
					
					showMusic.play();
				}
				

			}

			
		})
	</script>
</body>
</html>